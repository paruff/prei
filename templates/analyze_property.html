{% extends "base.html" %}
{% block title %}Analyze Property{% endblock %}
{% block content %}
  <h1>Analyze Property</h1>
  {% if error %}
    <p style="color:red">{{ error }}</p>
  {% else %}
    <h2>{{ property }}</h2>
    <p><a href="{% url 'report_property' property.id %}">Open Property Report</a></p>
    <h3>Financial KPIs</h3>
    <ul>
      <li>NOI: ${{ analysis.noi }}</li>
      <li>Cap Rate: {{ analysis.cap_rate|floatformat:4 }}</li>
      <li>Cash-on-Cash: {{ analysis.cash_on_cash|floatformat:4 }}</li>
      <li>IRR: {{ analysis.irr|floatformat:4 }}</li>
      <li>DSCR: {{ analysis.dscr|floatformat:4 }}</li>
    </ul>

    <h3>Carry Costs (What-if)</h3>
    <form method="post" style="margin-bottom:1rem">
      {% csrf_token %}
      <label>Taxes (monthly) <input type="number" step="0.01" name="taxes" value="{{ carry_costs.taxes|default:0 }}" /></label>
      <label>Insurance (monthly) <input type="number" step="0.01" name="insurance" value="{{ carry_costs.insurance|default:0 }}" /></label>
      <label>Maintenance (monthly) <input type="number" step="0.01" name="maintenance" value="{{ carry_costs.maintenance|default:0 }}" /></label>
      <label>Mgmt Fees (monthly) <input type="number" step="0.01" name="management_fees" value="{{ carry_costs.management_fees|default:0 }}" /></label>
      <label>Rehab Estimate (one-time) <input type="number" step="0.01" name="rehab_estimate" value="{{ carry_costs.rehab_estimate|default:0 }}" /></label>
      <button type="submit">Recalculate</button>
    </form>
    <table>
      <thead>
        <tr><th>Category</th><th>Monthly</th></tr>
      </thead>
      <tbody>
        <tr><td>Taxes</td><td>${{ carry_costs.taxes }}</td></tr>
        <tr><td>Insurance</td><td>${{ carry_costs.insurance }}</td></tr>
        <tr><td>Maintenance</td><td>${{ carry_costs.maintenance }}</td></tr>
        <tr><td>Management Fees</td><td>${{ carry_costs.management_fees }}</td></tr>
      </tbody>
    </table>

    <h3>Projected Monthly Cash Flow</h3>
    <p>${{ carry_costs.projected_monthly_cash_flow|floatformat:2 }}</p>
  {% endif %}
{% endblock %}