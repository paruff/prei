<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Investor Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, sans-serif; margin: 2rem; }
      table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ddd; padding: 8px; }
      th { background: #f7f7f7; text-align: left; }
    </style>
  </head>
  <body>
    <h1>Top Properties</h1>
    <table>
      <thead>
        <tr>
          <th>Property</th>
          <th>NOI</th>
          <th>Cap Rate</th>
          <th>Cash-on-Cash</th>
          <th>IRR</th>
          <th>DSCR</th>
          <th>Updated</th>
        </tr>
      </thead>
      <tbody>
        {% for a in analyses %}
          <tr>
            <td>{{ a.property }}</td>
            <td>${{ a.noi }}</td>
            <td>{{ a.cap_rate|floatformat:4 }}</td>
            <td>{{ a.cash_on_cash|floatformat:4 }}</td>
            <td>{{ a.irr|floatformat:4 }}</td>
            <td>{{ a.dscr|floatformat:4 }}</td>
            <td>{{ a.updated_at }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="7">No properties yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>

    <h2 style="margin-top:2rem">New Listings</h2>
    <form method="get" style="margin-bottom:1rem">
      <label>Min Price <input type="number" name="min_price" value="{{ request.GET.min_price }}" /></label>
      <label>Max Price <input type="number" name="max_price" value="{{ request.GET.max_price }}" /></label>
      <label>State <input type="text" name="state" value="{{ request.GET.state }}" /></label>
      <button type="submit">Filter</button>
    </form>

    <table>
      <thead>
        <tr>
          <th>Address</th>
          <th>City</th>
          <th>State</th>
          <th>Price</th>
          <th>Beds</th>
          <th>Baths</th>
          <th>Sq Ft</th>
          <th>Source</th>
          <th>Posted</th>
          <th>Score (V1)</th>
          <th>Link</th>
        </tr>
      </thead>
      <tbody>
        {% for item in listings %}
          <tr>
            <td>{{ item.obj.address }}</td>
            <td>{{ item.obj.city }}</td>
            <td>{{ item.obj.state }}</td>
            <td>${{ item.obj.price }}</td>
            <td>{{ item.obj.beds }}</td>
            <td>{{ item.obj.baths }}</td>
            <td>{{ item.obj.sq_ft }}</td>
            <td>{{ item.obj.source }}</td>
            <td>{{ item.obj.posted_at }}</td>
            <td>{{ item.score|floatformat:2 }}</td>
            <td><a href="{{ item.obj.url }}" target="_blank" rel="noopener noreferrer">View</a></td>
          </tr>
        {% empty %}
          <tr><td colspan="11">No listings available.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </body>
  </html>
