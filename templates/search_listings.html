{% extends "base.html" %}
{% block title %}Find Properties{% endblock %}
{% block content %}
  <h1>Find Properties</h1>
  <form method="get" style="margin-bottom:1rem">
    <label>Query <input type="text" name="q" value="{{ q }}" /></label>
    <label>ZIP <input type="text" name="zip" value="{{ zip }}" /></label>
    <label>State <input type="text" name="state" value="{{ state }}" /></label>
    <label>Min Price <input type="number" name="min_price" value="{{ min_price }}" /></label>
    <label>Max Price <input type="number" name="max_price" value="{{ max_price }}" /></label>
    <label>Sort
      <select name="sort">
        <option value="score" {% if sort == 'score' %}selected{% endif %}>Score</option>
        <option value="price" {% if sort == 'price' %}selected{% endif %}>Price</option>
      </select>
    </label>
    <button type="submit">Search</button>
  </form>

  {% if request.user.is_authenticated %}
  <form method="post" style="margin-bottom:1rem">
    {% csrf_token %}
    <input type="hidden" name="min_price" value="" />
    <input type="hidden" name="max_price" value="" />
    <label>Name <input type="text" name="name" placeholder="Save this search as..." /></label>
    <button type="submit">Save Search</button>
  </form>
  <h3>Saved Searches</h3>
  <ul>
    {% for s in saved %}
      <li>
        {{ s.name }} â€” {{ s.state }} {{ s.zip_code }} (q={{ s.query }})
        <a href="?saved_id={{ s.id }}&sort={{ sort }}" style="margin-left:0.5rem">Apply</a>
      </li>
    {% empty %}
      <li>No saved searches yet.</li>
    {% endfor %}
  </ul>
  {% endif %}

  <table>
    <thead>
      <tr>
        <th>Address</th>
        <th>City</th>
        <th>State</th>
        <th>ZIP</th>
        <th>Price</th>
        <th>Beds</th>
        <th>Baths</th>
        <th>Sq Ft</th>
        <th>Score (V1)</th>
        <th>Link</th>
      </tr>
    </thead>
    <tbody>
      {% for item in items %}
        <tr>
          <td>{{ item.obj.address }}</td>
          <td>{{ item.obj.city }}</td>
          <td>{{ item.obj.state }}</td>
          <td>{{ item.obj.zip_code }}</td>
          <td>${{ item.obj.price }}</td>
          <td>{{ item.obj.beds }}</td>
          <td>{{ item.obj.baths }}</td>
          <td>{{ item.obj.sq_ft }}</td>
          <td>{{ item.score|floatformat:2 }}</td>
          <td><a href="{{ item.obj.url }}" target="_blank" rel="noopener noreferrer">View</a></td>
        </tr>
      {% empty %}
        <tr><td colspan="10">No results.</td></tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}